<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>대한민국 시·도 SVG 차트 (Vanilla JS)</title>
  <style>
    body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Apple SD Gothic Neo, Helvetica, Arial, sans-serif; margin: 0; color: #111827; }

    .page { padding: 28px 24px 60px; width: fit-content; max-width: 1200px; margin: 0 auto; }

    h2 { margin: 0 0 12px; font-size: 28px; }

    .chart { background: #fff; border-radius: 14px; box-shadow: 0 10px 24px rgba(17,24,39,0.08); padding: 20px; margin: 20px 0; }
  </style>
</head>
<body>
  <div class="page">
    <div class="chart" id="rates">
      <h2>지역별 확보율</h2>
      <div id="korea-rates"></div>
    </div>
    <div class="chart" id="counts">
      <h2>지역별 분석 문항수</h2>
      <div id="korea-counts"></div>
    </div>
  </div>

  <script src="KorMapChart.js"></script>
  <script>
    const KOR_NAME_TO_CODE = {
      '서울': 'KR-11',
      '부산': 'KR-26',
      '대구': 'KR-27',
      '인천': 'KR-28',
      '광주': 'KR-29',
      '대전': 'KR-30',
      '울산': 'KR-31',
      '세종': 'KR-50',
      '경기': 'KR-41',
      '강원': 'KR-42',
      '충북': 'KR-43',
      '충남': 'KR-44',
      '전북': 'KR-45',
      '전남': 'KR-46',
      '경북': 'KR-47',
      '경남': 'KR-48',
      '제주': 'KR-49',
    };

    // 더미 데이터
    const countData = {
      '서울': { count: 4339, rate: 0.93 },
      '인천': { count: 1406, rate: 0.80 },
      '경기': { count: 5331, rate: 0.63 },
      '세종': { count: 286,  rate: 0.74 },
      '충남': { count: 674,  rate: 0.40 },
      '대전': { count: 849,  rate: 0.76 },
      '전북': { count: 705,  rate: 0.34 },
      '광주': { count: 969,  rate: 0.87 },
      '전남': { count: 226,  rate: 0.11 },
      '제주': { count: 346,  rate: 0.61 },
      '강원': { count: 147,  rate: 0.08 },
      '충북': { count: 351,  rate: 0.31 },
      '경북': { count: 581,  rate: 0.22 },
      '대구': { count: 1364, rate: 0.93 },
      '울산': { count: 690,  rate: 0.80 },
      '부산': { count: 958,  rate: 0.50 },
      '경남': { count: 529,  rate: 0.20 },
    };

    const rateData = {
      '대구': 0.93,
      '서울': 0.87,
      '광주': 0.87,
      '울산': 0.80,
      '대전': 0.76,
      '세종': 0.74,
      '인천': 0.80,
      '경기': 0.63,
      '제주': 0.61,
      '부산': 0.50,
      '충남': 0.40,
      '전북': 0.34,
      '충북': 0.31,
      '경북': 0.22,
      '경남': 0.20,
      '전남': 0.11,
      '강원': 0.08,
    };

    const SEOUL_NAME_TO_CODE = {
      '도봉구': 'SEOUL-1',
      '동대문구': 'SEOUL-2',
      '동작구': 'SEOUL-3',
      '은평구': 'SEOUL-4',
      '강북구': 'SEOUL-5',
      '강동구': 'SEOUL-6',
      '강서구': 'SEOUL-7',
      '금천구': 'SEOUL-8',
      '구로구': 'SEOUL-9',
      '관악구': 'SEOUL-10',
      '광진구': 'SEOUL-11',
      '강남구': 'SEOUL-12',
      '종로구': 'SEOUL-13',
      '중구': 'SEOUL-14',
      '중랑구': 'SEOUL-15',
      '마포구': 'SEOUL-16',
      '노원구': 'SEOUL-17',
      '서초구': 'SEOUL-18',
      '서대문구': 'SEOUL-19',
      '성북구': 'SEOUL-20',
      '성동구': 'SEOUL-21',
      '송파구': 'SEOUL-22',
      '양천구': 'SEOUL-23',
      '영등포구': 'SEOUL-24',
      '용산구': 'SEOUL-25',
    };

    const SEOUL_RATE_DATA = {
      '종로구': 0.82,
      '중구': 0.75,
      '용산구': 0.78,
      '성동구': 0.71,
      '광진구': 0.74,
      '동대문구': 0.69,
      '중랑구': 0.64,
      '성북구': 0.67,
      '강북구': 0.62,
      '도봉구': 0.66,
      '노원구': 0.65,
      '은평구': 0.68,
      '서대문구': 0.70,
      '마포구': 0.79,
      '양천구': 0.73,
      '강서구': 0.61,
      '구로구': 0.60,
      '금천구': 0.58,
      '영등포구': 0.76,
      '동작구': 0.72,
      '관악구': 0.23,
      '서초구': 0.85,
      '강남구': 0.90,
      '송파구': 0.88,
      '강동구': 0.74,
    };

    const renderSeoulRate = async () => {
      KorMapChart.render(SEOUL_NAME_TO_CODE, '#korea-rates', {
        svgUrl: '/seoul.svg',
        data: SEOUL_RATE_DATA,
        map: { width: 800, height: 620 },
        labels: {
          fontSize: 24,
          strokeWidth: 5,
          offsets: { 
            // '서울': [2, -2],
            // '인천': [2, 0],
            // '충북': [-20, -20]
          },
        },
        rates: [0.8, 0.6, 0.4, 0.2],
        colors: ['#00085A', '#1F48FF', '#79a1ee', '#99d9f2', '#D7D7D7'],
        gap: 24,
        bar: {
          width: 180,
          height: 18,
          gap: 12,
          rowGap: 8,
          labelWidth: 56,
          rounded: 4,
          labelAlign: 'right',
          valueSize: 12,
        },
        events: {
          hoverStyle: { opacity: 0.8, cursor: 'pointer' },
          onRegionEnter: (name, el, data) => {
            // console.log(name, datum);
          },
          onRegionClick: (name, el, data) => {
          },
        },
      });
    }

    const renderKoreaRate = async () => {
      KorMapChart.render(KOR_NAME_TO_CODE, '#korea-rates', {
        svgUrl: '/south_korea.svg',
        data: rateData,
        map: { width: 420, height: 620 },
        labels: {
          fontSize: 12,
          strokeWidth: 2.5,
          offsets: { 
            '경기': [10, 10],
            '인천': [2, 0],
            '충북': [-20, -20]
          },
        },
        rates: [0.8, 0.6, 0.4, 0.2],
        colors: ['#00085A', '#1F48FF', '#79a1ee', '#99d9f2', '#D7D7D7'],
        gap: 24,
        bar: {
          width: 180,
          height: 18,
          gap: 12,
          rowGap: 8,
          labelWidth: 56,
          rounded: 4,
          labelAlign: 'right',
          valueSize: 12,
        },
        events: {
          hoverStyle: { opacity: 0.8, cursor: 'pointer' },
          onRegionEnter: (name, el, data) => {
            // console.log(name, datum);
          },
          onRegionClick: (name, el, data) => {
            if (name === '서울') {
              renderSeoulRate();
            }
          },
        },
      });
    }

    const renderKoreaCount = async () => {
        KorMapChart.render(KOR_NAME_TO_CODE, '#korea-counts', {
        mode: 'count+callouts',
        svgUrl: '/south_korea.svg',
        data: countData,
        map: { width: 800 },
        labels: { 
          fontSize: 12,
          strokeWidth: 2.5,
          offsets: {
            '경기': [20, 20],
            '충북': [-10, -30],
          },
         },
        rates: [0.8, 0.6, 0.4, 0.2],
        colors: ['#00085A', '#1F48FF', '#79a1ee', '#99d9f2', '#D7D7D7'],
        callouts: {
          padding: 40,
          margin: 100,
          textOffset: -4,
          lineColor: '#FF0000',
          lineWidth: 1,
          lineDash: '4 2',
          pinColor: '#1B4EFF',
          textColor: '#4B5563',
          bypass: {
            '서울': [-20, -20],
            '경기': [-20, 20],
            '세종': [-20, 20],
            '대전': [-20, 20],
            '부산': [20, 20],
            '경남': [50, 50],
          },
          offsets: {
            '경기': [20, 20],
            '충북': [-20, -20],
            '강원': [20, 20],
            '경북': [0, 20],
            '부산': [0, 10],
            '경남': [0, 15],
          },
          formatter: (name, count) => `${name} : ${count?.toLocaleString('ko-KR') ?? '-'}`,
        },
        events: {
          // hoverStyle: { opacity: 0.8, cursor: 'pointer' },
          onRegionEnter: (name, el, data) => {
            // console.log(name, datum);
          },
          onRegionClick: (name, el, data) => {
            
          },
        },
      });
    }

    // ======== 실행 ========
    (async function(){
      await renderKoreaRate();
      await renderKoreaCount();
    })();
  </script>
</body>
</html>
